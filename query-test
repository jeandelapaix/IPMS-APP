SELECT 
    JSON_ARRAYAGG(
        JSON_OBJECT(
            'accountNo', mr.MCES_ACCOUNT_NUMBER,
            'bankId', mr.MCES_BANK_ID,
            'paymentCategory', JSON_ARRAYAGG(cppc.CATEGORY_TYPE)
        )
    ) AS accountLst
FROM 
    MCES_COMPANY mc
    JOIN COMP_APP ca ON ca.ACTIVE_COMP_PKREF = mc.COMP_PK
    JOIN COMP_PAYMENT_PROFILE cpp ON cpp.CMAP_PKREF = ca.CMAP_PK
    JOIN COMP_PAYMENT_PROFILE_ACCT cppa ON cppa.ACTIVE_PYMT_PROF_PKREF = cpp.PYMT_PROF_PK
    JOIN COMP_RESOURE cr ON cr.CRES_PK = cppa.CRES_PKREF
    JOIN MCES_RESOURCE mr ON mr.RESOURCE_PK = cr.RESOURCE_PKREF
    LEFT JOIN COMP_PAYMENT_PROFILE_PYMT_CTGR cppc ON cppc.ACTIVE_PYMT_PROF_PKREF = cpp.PYMT_PROF_PK
WHERE 
    mc.COMP_ID = :companyId
    AND cpp.PROFILE_CODE = :profileCode
GROUP BY 
    mr.MCES_ACCOUNT_NUMBER, mr.MCES_BANK_ID;


SELECT 
    JSON_ARRAYAGG(
        JSON_OBJECT(
            'id', cppr.PYMT_PROF_RANGE_PK,
            'minAmount', cppr.AMT_RANGE_MIN,
            'maxAmount', cppr.AMT_RANGE_MAX
        )
    ) AS range
FROM 
    COMP_PAYMENT_PROFILE cpp
    JOIN COMP_PAYMENT_PROFILE_RANGE cppr ON cppr.ACTIVE_PYMT_PROF_PKREF = cpp.PYMT_PROF_PK
WHERE 
    cpp.PROFILE_CODE = :profileCode
    AND cpp.CMAP_PKREF = (
        SELECT CMAP_PK FROM COMP_APP WHERE ACTIVE_COMP_PKREF = (
            SELECT COMP_PK FROM MCES_COMPANY WHERE COMP_ID = :companyId
        )
    );
