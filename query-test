SELECT 
    ct.PYMT_PROF_TIER_PK AS tierId,
    ct.AMT_RANGE_MIN AS minAmount,
    ct.AMT_RANGE_MAX AS maxAmount,
    
    cpl.PANEL_ID_PKREF AS panelId,
    cpl.PANEL_APPROVAL_ORDER AS approvalOrder,
    
    cpgrp.PYMT_PROF_PANEL_APP_GRP_PK AS groupId,
    cpgrp.SORT_ORDER AS orderInPanel,
    cpgrp.NO_OF_APPROVAL_REQUIRED AS approvalsRequired
FROM 
    COMP_PAYMENT_PROFILE cpp
    JOIN COMP_PAYMENT_PROFILE_TIER ct ON cpp.PYMT_PROF_PK = ct.ACTIVE_PYMT_PROF_PKREF
    LEFT JOIN COMP_PAYMENT_PROFILE_PANEL cpl ON cpl.ACTIVE_PYMT_PROF_PKREF = cpp.PYMT_PROF_PK
    LEFT JOIN COMP_PYMT_PROFILE_PANEL_APPGRP cpgrp ON cpl.PANEL_ID_PKREF = cpgrp.PANEL_ID_PKREF
    JOIN COMP_PYMT_PROF_TIER_PANEL_ID cptpi ON ct.TIER_ID_PKREF = cptpi.TIER_PANEL_ID_PK
WHERE 
    cpp.PROFILE_CODE = :profileCode
    AND cpp.CMAP_PKREF = (
        SELECT CMAP_PK FROM COMP_APP 
        WHERE ACTIVE_COMP_PKREF = (
            SELECT COMP_PK FROM MCES_COMPANY WHERE COMP_ID = :companyId
        )
    );
